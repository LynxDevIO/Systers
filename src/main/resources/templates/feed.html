<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Systers Feed</title>
    <link rel="stylesheet" href="css/feed.css">
</head>
<body>
<!-- Barra superior -->
<header class="top-bar">
    <div class="logo">Systers</div>
    <nav class="nav-bar">
        <button class="nav-btn" onclick="window.location.href='/feed';">Home</button>
        <button class="nav-btn" onclick="window.location.href='/perfil/me';">Meu Perfil</button>
        <button class="nav-btn" onclick="window.location.href='/grupos';">Grupo</button>
        <button class="nav-btn" onclick="window.location.href='/mentorias';">Mentoria</button>
        <button class="nav-btn" onclick="document.getElementById('logoutForm').submit();">Logout</button>
    </nav>
    <!-- Formulário de Logout Global -->
    <form id="logoutForm" th:action="@{/logout}" method="post" style="display: none;">
        <input type="hidden" name="_csrf" th:value="${_csrf.token}" />
    </form>
</header>


<!-- Container principal -->
<div class="container">
    <!-- Conteúdo principal -->
    <main>

        <!-- Posts -->
        <div class="container">
            <!-- Conteúdo principal -->
            <main>
                <!-- Posts -->
                <div id="posts-container">
                    <!-- posagens carregadas com o script -->
                </div>
            </main>
        </div>
    </main>
</div>

<!-- Rodapé -->
<footer class="footer">
    <p>&copy; 2024 Systers</p>
</footer>
</body>
</html>

<script>
    // Função para carregar postagens no DOM
    function loadPosts(posts) {
        const postsContainer = document.getElementById("posts-container");
        postsContainer.innerHTML = ""; // Limpa postagens anteriores

        if (posts.length === 0) {
            // Exibe mensagem caso não haja postagens
            const noPostsMessage = document.createElement("div");
            noPostsMessage.className = "no-posts-message";
            noPostsMessage.innerHTML = "<p>Não há postagens para exibir.</p>";
            postsContainer.appendChild(noPostsMessage);
            return; // Sai da função se não houver postagens
        }

        posts.forEach(post => {
            const postElement = document.createElement("div");
            postElement.className = "post";
            postElement.innerHTML = `
              <div class="post-header">
                  <div class="profile-pic"></div>
                  <div class="post-info">
                      <h4>${post.grupo.nome}</h4>
                      <p>${post.autor.usuario.login}</p>
                      <p>${post.conteudo}</p>
                  </div>
              </div>
              <div class="post-content">
                  <p>${post.conteudo}</p>
              </div>
          `;
            postsContainer.appendChild(postElement);
        });
    }

    // Função para carregar postagens do servidor
    async function loadPostsFromServer() {
        try {
            const response = await fetch('/api/postagens/ultimas');
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            const posts = await response.json();
            loadPosts(posts); // Chama a função para carregar postagens no DOM
        } catch (error) {
            console.error('Erro ao carregar postagens:', error);
        }
    }

    // Carrega as postagens do servidor
    loadPostsFromServer();
</script>